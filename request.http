###############################################################################
# TRAINING PROJECT - API TESTING FILE
# HOW TO USE:
# 1. Login once (Admin/Customer/Provider)
# 2. Cookie is saved automatically by HTTP client
# 3. All subsequent requests use the cookie automatically
# 4. To switch user: Logout â†’ Login with different account
###############################################################################
### Variables
@baseUrl = http://localhost:8081
@adminEmail = admin@trainingproject.com
@adminPassword = Admin@12345
@customerEmail = customer2@example.com
@customerPassword = Customer@123
@providerEmail = provider223242@example.com
@providerPassword = Provider@123
### ============================================================================
### ðŸ” STEP 1: LOGIN (Choose One - Cookie Will Be Saved Automatically)
### ============================================================================
### ---------- Login as ADMIN ----------
# @name login-admin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### --Get All Services with Bookings
GET {{baseUrl}}/api/admin/services/all-bookings


### ---------- Login as CUSTOMER ---------
# @name login-customer
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{customerEmail}}",
  "password": "{{customerPassword}}"
}
### ---------- Login as SERVICE PROVIDER -------
# @name login-provider
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{providerEmail}}",
  "password": "{{providerPassword}}"
}
### ---------- LOGOUT (Clear Cookies) ----------
# @name logout
POST {{baseUrl}}/api/auth/logout
### ---------- REFRESH TOKEN (Renew Access Token) ----------
### Use this when you get 403 Forbidden (token expired)
### Refresh Token (30 days) will auto-renew Access Token (7 days)
# @name refresh-token
POST {{baseUrl}}/api/auth/refresh
# Cookie sent automatically (refreshToken)
### ============================================================================
### PHASE 1: AUTHENTICATION & USER MANAGEMENT
### ============================================================================

### ---------- 1.1 Register Customer ----------
# @name register-customer
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "John",
  "lastName": "Doe",
  "email": "{{customerEmail}}",
  "password": "{{customerPassword}}",
  "phone": "+1234567890",
  "role": "CUSTOMER"
}

### ---------- 1.2 Register Service Provider ----------
# @name register-provider
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "Jane",
  "lastName": "Smith",
  "email": "{{providerEmail}}",
  "password": "{{providerPassword}}",
  "phone": "+0987654321",
  "role": "SERVICE_PROVIDER",
  "bio": "Expert Java developer with 10 years of experience",
  "professionalTitle": "Senior Software Engineer",
  "certificateUrl": "https://example.com/certificates/jane-smith.pdf"
}

### ---------- 1.3 Login with Wrong Password (Expect 401) ----------
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "wrongpassword"
}

### ---------- 1.7 Register with Duplicate Email (Expect 409) ----------
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "Duplicate",
  "lastName": "User",
  "email": "{{customerEmail}}",
  "password": "Password@123",
  "role": "CUSTOMER"
}

### ---------- 1.8 Register with Invalid Email (Expect 400) ----------
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "Invalid",
  "lastName": "Email",
  "email": "invalid-email",
  "password": "Password@123",
  "role": "CUSTOMER"
}


### ============================================================================
### PHASE 2: ADMIN OPERATIONS
### âš ï¸ IMPORTANT: Login as ADMIN first (see STEP 1 above)
### All requests below will use the cookie automatically - no manual headers needed!
### ============================================================================

### ---------- 2.1 Get Pending Provider Approvals ----------
GET {{baseUrl}}/api/admin/providers/pending

### ---------- 2.2 Approve Service Provider ----------
# @name approve-provider
PUT {{baseUrl}}/api/admin/providers/16/approve
Content-Type: application/json

{
  "adminNotes": "Credentials verified. Approved for service offering."
}

### ---------- 2.3 Reject Service Provider ----------
PUT {{baseUrl}}/api/admin/providers/3/reject
Content-Type: application/json

{
  "adminNotes": "Insufficient credentials provided."
}

### ---------- 2.4 Get All Categories (Admin View) ----------
GET {{baseUrl}}/api/admin/categories

### ---------- 2.5 Create New Category ----------
# @name create-category-programming
POST {{baseUrl}}/api/admin/categories
Content-Type: application/json

{
  "name": "Programming",
  "description": "Software development and programming courses",
  "iconUrl": "https://example.com/icons/programming.png",
  "isActive": true
}

### ---------- 2.6 Create Category: Design ----------
POST {{baseUrl}}/api/admin/categories
Content-Type: application/json

{
  "name": "HARDWARE",
  "description": "Graphic design, UI/UX, and creative services",
  "iconUrl": "https://example.com/icons/design.png",
  "isActive": true
}

### ---------- 2.7 Create Category: Marketing ----------
POST {{baseUrl}}/api/admin/categories
Content-Type: application/json

{
  "name": "Marketing",
  "description": "Digital marketing and social media services",
  "iconUrl": "https://example.com/icons/marketing.png",
  "isActive": true
}

### ---------- 2.8 Update Category ----------
PUT {{baseUrl}}/api/admin/categories/1
Content-Type: application/json

{
  "name" : "programming",
  "description": "Advanced programming and software engineering courses",
  "isActive": true
}

### ---------- 2.9 Delete Category (Will fail if services exist) ----------
DELETE {{baseUrl}}/api/admin/categories/7

### ---------- 2.10 Create Subscription Plan: Basic ----------
# @name create-plan-basic
POST {{baseUrl}}/api/admin/subscription-plans
Content-Type: application/json

{
  "name": "Basic Plan",
  "description": "Perfect for starting providers - 1 month access",
  "price": 100.00,
  "durationDays": 30
}

### ---------- 2.11 Create Subscription Plan: Pro ----------
POST {{baseUrl}}/api/admin/subscription-plans
Content-Type: application/json

{
  "name": "Pro Plan",
  "description": "Most popular - 3 months access with 20% discount",
  "price": 150.99,
  "durationDays": 90
}

### ---------- 2.12 Create Subscription Plan: Enterprise ----------
POST {{baseUrl}}/api/admin/subscription-plans
Content-Type: application/json

{
  "name": "Enterprise Plan",
  "description": "Best value - 12 months access with 40% discount",
  "price": 215.99,
  "durationDays": 365
}

### ---------- 2.13 Get All Subscription Plans ----------
GET {{baseUrl}}/api/admin/subscription-plans

### ---------- 2.14 Update Subscription Plan ----------
PUT {{baseUrl}}/api/admin/subscription-plans/1
Content-Type: application/json

{
  "price": 150.00 ,
  "description": "Starter plan - 1 month access (LIMITED OFFER!)"
}

### ---------- 2.15 Get Platform Statistics ----------
GET {{baseUrl}}/api/admin/stats

### ---------- 2.16 Get All Transactions ----------
GET {{baseUrl}}/api/admin/transactions

### ---------- 2.17 Get Pending Refund Requests ----------
GET {{baseUrl}}/api/admin/refunds/pending

### ---------- 2.18 Approve Refund Request ----------
PUT {{baseUrl}}/api/admin/refunds/1/approve
Content-Type: application/json

{
  "adminNotes": "Refund approved as per company policy."
}

### ---------- 2.19 Reject Refund Request ----------
PUT {{baseUrl}}/api/admin/refunds/2/reject
Content-Type: application/json

{
  "adminNotes": "Service already completed. Refund not applicable."
}


### ---------- 2.21 Access Admin Endpoint as Customer (Expect 403) ----------
GET {{baseUrl}}/api/admin/stats
# Cookie sent automatically


### ============================================================================
### PHASE 3: SERVICE PROVIDER OPERATIONS
### âš ï¸ IMPORTANT: Login as SERVICE PROVIDER first (see STEP 1 above)
### All requests below will use the cookie automatically - no manual headers needed!
### ============================================================================

### ---------- 3.1 Get Available Subscription Plans (Public) ----------
GET {{baseUrl}}/api/subscriptions/plans

### ---------- 3.2 Subscribe to Plan (Basic Plan) ----------
# @name subscribe-basic
POST {{baseUrl}}/api/subscriptions/subscribe
# Cookie sent automatically
Content-Type: application/json

{
  "planId": 3,
  "paymentMethod": "card",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "expiryMonth": 12,
    "expiryYear": 2026,
    "cvv": "123",
    "cardHolderName": "Jane Smith",
    "billingAddress": "123 Main Street, San Francisco, CA 94102"
  }
}


### ---------- 3.3 Get My Subscription ----------
GET {{baseUrl}}/api/subscriptions/my-subscription
# Cookie sent automatically

### ---------- 3.4 Cancel Auto-Renewal ----------
PUT {{baseUrl}}/api/subscriptions/cancel-renewal
# Cookie sent automatically

### ---------- 3.5 Create Service: Java Course ----------
# @name create-service-java
POST {{baseUrl}}/api/provider/services
# Cookie sent automatically
Content-Type: application/json

{
  "categoryId": 1,
  "title": "Advanced Java Programming",
  "description": "Master Java 17+ features including records, sealed classes, pattern matching, and more",
  "price": 79.99,
  "durationMinutes": 60,
  "serviceType": "BOTH",
  "locationAddress": "123 Tech Street, Silicon Valley, CA"
}

### ---------- 3.6 Create Service: Spring Boot ----------
POST {{baseUrl}}/api/provider/services
# Cookie sent automatically
Content-Type: application/json

{
  "categoryId": 1,
  "title": "Spring Boot Microservices",
  "description": "Build production-ready microservices with Spring Boot, Docker, and Kubernetes",
  "price": 99.99,
  "durationMinutes": 90,
  "serviceType": "ONLINE",
  "locationAddress": null
}

### ---------- 3.7 Create Service: React Development ----------
POST {{baseUrl}}/api/provider/services
# Cookie sent automatically
Content-Type: application/json

{
  "categoryId": 1,
  "title": "React & Next.js Development",
  "description": "Build modern web applications with React 18 and Next.js 14",
  "price": 59.99,
  "durationMinutes": 60,
  "serviceType": "ONLINE"
}

### ---------- 3.8 Get My Services ----------
GET {{baseUrl}}/api/provider/services
# Cookie sent automatically

### ---------- 3.9 Update Service ----------
PUT {{baseUrl}}/api/provider/services/11
# Cookie sent automatically
Content-Type: application/json

{
  "durationMinutes": 120,
  "description": "Master Java 21 features including virtual threads, record patterns, and more (UPDATED CONTENT!)"
}

### ---------- 3.10 Delete Service ----------
DELETE {{baseUrl}}/api/provider/services/9
# Cookie sent automatically

### ---------- 3.11 Set Availability: Monday ----------
### âš ï¸ IMPORTANT: Slots are generated based on SERVICE DURATION
### Example: If service duration = 120 minutes, availability 09:00-11:00 = 1 slot (09:00-11:00)
### Example: If service duration = 60 minutes, availability 09:00-11:00 = 2 slots (09:00-10:00, 10:00-11:00)
###
### If you UPDATE service duration, you MUST:
### 1. Delete old availability (DELETE /api/provider/availability/{id})
### 2. Create new availability (POST below)
### This regenerates slots with correct duration!
# @name set-availability-monday
POST {{baseUrl}}/api/provider/availability
# Cookie sent automatically
Content-Type: application/json

{
  "dayOfWeek": "MONDAY",
  "startTime": "09:00:00",
  "endTime": "11:00:00"
}

### ---------- 3.12 Set Availability: Wednesday ----------
POST {{baseUrl}}/api/provider/availability
# Cookie sent automatically
Content-Type: application/json

{
  "dayOfWeek": "WEDNESDAY",
  "startTime": "10:00:00",
  "endTime": "12:00:00"
}

### ---------- 3.13 Set Availability: Friday ----------
POST {{baseUrl}}/api/provider/availability
# Cookie sent automatically
Content-Type: application/json

{
  "dayOfWeek": "FRIDAY",
  "startTime": "09:00:00",
  "endTime": "15:00:00"
}

### ---------- 3.14 Get My Availability ----------
GET {{baseUrl}}/api/provider/availability
# Cookie sent automatically

### ---------- 3.15 Set Overlapping Availability (Expect 400) ----------
POST {{baseUrl}}/api/provider/availability
# Cookie sent automatically
Content-Type: application/json

{
  "dayOfWeek": "MONDAY",
  "startTime": "14:00:00",
  "endTime": "20:00:00"
}

### ---------- 3.16 Delete Availability (Deletes ALL Monday slots across ALL your services) ----------
### âœ… USE CASE: When you update service duration (e.g., 60 â†’ 120 minutes)
###   1. Delete old availability: DELETE /api/provider/availability/{id}
###   2. Create new availability: POST /api/provider/availability (same times)
###   â†’ This regenerates slots with correct duration!
DELETE {{baseUrl}}/api/provider/availability/14
# Cookie sent automatically

### ---------- 3.16a Get My Time Slots (All Services) ----------
GET {{baseUrl}}/api/provider/time-slots
# Cookie sent automatically

### ---------- 3.16b Get Time Slots for Specific Service ----------
GET {{baseUrl}}/api/provider/time-slots?serviceId=11
# Cookie sent automatically

### ---------- 3.16c Get Time Slots with Date Range ----------
GET {{baseUrl}}/api/provider/time-slots?fromDate=2026-01-01&toDate=2026-01-10
# Cookie sent automatically

### ---------- 3.16d Get Only BLOCKED Slots ----------
GET {{baseUrl}}/api/provider/time-slots?status=BLOCKED
# Cookie sent automatically

### ---------- 3.16e Block Specific Time Slot ----------
### âœ… BETTER SOLUTION: Block ONE slot instead of deleting entire day!
### Example: Block Monday 05/01/2026 11:00-12:00 only
PUT {{baseUrl}}/api/provider/time-slots/194/block
# Cookie sent automatically

### ---------- 3.16f Unblock Time Slot (Make Available Again) ----------
PUT {{baseUrl}}/api/provider/time-slots/194/unblock
# Cookie sent automatically

### ---------- 3.17 Get My Bookings ----------
GET {{baseUrl}}/api/provider/bookings
# Cookie sent automatically

### ---------- 3.18 Mark Booking as Completed ----------
PUT {{baseUrl}}/api/provider/bookings/1/complete
# Cookie sent automatically

### ---------- 3.19 Get My Reviews ----------
GET {{baseUrl}}/api/provider/reviews
# Cookie sent automatically


### ============================================================================
### PHASE 4: CUSTOMER & PUBLIC OPERATIONS
### âš ï¸ IMPORTANT: Login as CUSTOMER for protected endpoints (see STEP 1 above)
### Public endpoints (categories, services listing) don't require authentication
### Protected endpoints (bookings, reviews) will use cookie automatically
### ============================================================================

### ---------- 4.1 Get All Categories (Public) ----------
GET {{baseUrl}}/api/categories

### ---------- 4.2 Get Category by ID ----------
GET {{baseUrl}}/api/categories/1

### ---------- 4.3 Get All Active Services ----------
GET {{baseUrl}}/api/services

### ---------- 4.4 Search Services by Title ----------
GET {{baseUrl}}/api/services?search=Java

### ---------- 4.5 Filter Services by Category ID ----------
GET {{baseUrl}}/api/services?categoryId=1

### ---------- 4.7 Filter Services by Price Range ----------
GET {{baseUrl}}/api/services?minPrice=50&maxPrice=100

### ---------- 4.8 Filter by Category and Price Range ----------
GET {{baseUrl}}/api/services?categoryId=1&minPrice=100&maxPrice=200

### ---------- 4.9 Sort Services by Price (Low to High) ----------
GET {{baseUrl}}/api/services?categoryId=1&sortBy=price_low

### ---------- 4.10 Sort Services by Price (High to Low) ----------
GET {{baseUrl}}/api/services?categoryId=1&sortBy=price_high

### ---------- 4.11 Get Newest Services ----------
GET {{baseUrl}}/api/services?sortBy=newest

### ---------- 4.12 Get Service by ID ----------
GET {{baseUrl}}/api/services/1

### ---------- 4.13 Get Services by Category ----------
GET {{baseUrl}}/api/services/category/1

### ---------- 4.14 Get Available Time Slots (Next 30 Days - Default) ----------
### By default, shows all available slots for the next 30 days
### You can customize with: ?fromDate=YYYY-MM-DD&toDate=YYYY-MM-DD&limit=50
GET {{baseUrl}}/api/customer/services/8/slots
# Cookie sent automatically

### ---------- 4.14a Get Available Time Slots (Specific Date Range) ----------
GET {{baseUrl}}/api/customer/services/6/slots?fromDate=2026-01-05&toDate=2026-01-12
# Cookie sent automatically

### ---------- 4.14b Get Available Time Slots (Today Only) ----------
GET {{baseUrl}}/api/customer/services/8/slots?fromDate=2026-01-05&toDate=2026-01-05
# Cookie sent automatically

### ---------- 4.14c Get Available Time Slots (Limited to 10 slots) ----------
GET {{baseUrl}}/api/customer/services/8/slots?limit=10
# Cookie sent automatically

### ---------- 4.14d Get ALL Available Slots (Next 60 days) ----------
GET {{baseUrl}}/api/customer/services/6/slots?fromDate=2026-01-05&toDate=2026-03-06
# Cookie sent automatically

### ---------- 4.15 Create Booking ----------
# @name create-booking
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 10,
  "slotId": 194,
  "paymentMethod": "card",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "expiryMonth": 12,
    "expiryYear": 2026,
    "cvv": "123",
    "cardHolderName": "John Doe",
    "billingAddress": "456 Oak Avenue, New York, NY 10001"
  }
}

### ---------- 4.16 Get My Bookings ----------
GET {{baseUrl}}/api/customer/bookings
# Cookie sent automatically

### ---------- 4.17 Cancel Booking ----------
PUT {{baseUrl}}/api/customer/bookings/4/cancel
# Cookie sent automatically
Content-Type: application/json

{
  "cancellationReason": "Schedule conflict"
}

### ---------- 4.18 Submit Review (After Booking Completed) ----------
POST {{baseUrl}}/api/customer/reviews
# Cookie sent automatically
Content-Type: application/json

{
  "bookingId": 1,
  "rating": 5,
  "comment": "Excellent service! Very knowledgeable instructor. Highly recommended!"
}

### ---------- 4.19 Get My Transactions ----------
### Shows all payment transactions (BOOKING_PAYMENT, REFUND, etc.)
GET {{baseUrl}}/api/customer/transactions
# Cookie sent automatically

### ---------- 4.19a Get My Refunds ----------
### âœ… IMPORTANT: Check refund status here!
### - PENDING: Waiting for admin approval (>24hrs before booking)
### - APPROVED: Admin approved, refund being processed
### - COMPLETED: Refund processed successfully (will also appear in transactions)
### - REJECTED: Admin rejected the refund request
GET {{baseUrl}}/api/customer/refunds
# Cookie sent automatically

### ---------- 4.20 Request Refund ----------
POST {{baseUrl}}/api/customer/refunds
# Cookie sent automatically
Content-Type: application/json

{
  "bookingId": 2,
  "refundReason": "Service did not meet expectations"
}

### ---------- 4.21 Get My Notifications ----------
GET {{baseUrl}}/api/notifications
# Cookie sent automatically

### ---------- 4.22 Mark Notification as Read ----------
PUT {{baseUrl}}/api/notifications/1/read
# Cookie sent automatically

### ---------- 4.23 Book Already Booked Slot (Expect 409) ----------
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 1,
  "slotId": 1,
  "paymentMethod": "card",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "expiryMonth": 12,
    "expiryYear": 2026,
    "cvv": "123",
    "cardHolderName": "John Doe",
    "billingAddress": "456 Oak Avenue, New York, NY 10001"
  }
}

### ---------- 4.24 Submit Duplicate Review (Expect 409) ----------
POST {{baseUrl}}/api/customer/reviews
# Cookie sent automatically
Content-Type: application/json

{
  "bookingId": 1,
  "rating": 4,
  "comment": "Trying to submit again"
}

### ---------- 4.25 Review Non-Completed Booking (Expect 400) ----------
POST {{baseUrl}}/api/customer/reviews
# Cookie sent automatically
Content-Type: application/json

{
  "bookingId": 3,
  "rating": 5,
  "comment": "Premature review"
}

### ============================================================================
### PHASE 5: PAYMENT STRATEGY PATTERN TESTING
### Testing Stripe & PayPal Payment Methods
### ============================================================================

### ---------- 5.1 Test Subscription with STRIPE ----------
# First logout and login as a new provider
POST {{baseUrl}}/api/auth/logout

### Register new provider for Stripe testing
# @name register-stripe-provider
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "Stripe",
  "lastName": "TestProvider",
  "email": "stripe.test@example.com",
  "password": "Provider@123",
  "phone": "+1111111111",
  "role": "SERVICE_PROVIDER",
  "bio": "Testing Stripe payments",
  "professionalTitle": "Stripe Tester",
  "certificateUrl": "https://example.com/stripe-cert.pdf"
}

### Login as Admin to approve
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Get pending providers and approve the new one
GET {{baseUrl}}/api/admin/providers/pending

### Approve (replace {id} with actual ID from response)
PUT {{baseUrl}}/api/admin/providers/14/approve
# Cookie sent automatically
Content-Type: application/json

{
  "adminNotes": "Approved for Stripe payment testing"
}

### Logout and login as the Stripe provider
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "stripe.test@example.com",
  "password": "Provider@123"
}

### Subscribe using STRIPE payment method
# @name subscribe-stripe
POST {{baseUrl}}/api/subscriptions/subscribe
# Cookie sent automatically
Content-Type: application/json

{
  "planId": 1,
  "paymentMethod": "stripe",
  "autoRenew": true,
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "cardHolderName": "Stripe Test Provider",
    "expiryMonth": "12",
    "expiryYear": "2028",
    "cvv": "123",
    "billingAddress": "123 Stripe Street, CA"
  }
}

### Check transaction (should show STRIPE_ prefix in gateway transaction ID)
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

###
GET {{baseUrl}}/api/admin/transactions

### ---------- 5.2 Test Subscription with PAYPAL ----------
POST {{baseUrl}}/api/auth/logout

### Register new provider for PayPal testing
# @name register-paypal-provider
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "firstName": "PayPal",
  "lastName": "TestProvider",
  "email": "paypal.test@example.com",
  "password": "Provider@123",
  "phone": "+2222222222",
  "role": "SERVICE_PROVIDER",
  "bio": "Testing PayPal payments",
  "professionalTitle": "PayPal Tester",
  "certificateUrl": "https://example.com/paypal-cert.pdf"
}

### Login as Admin
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Get pending and approve PayPal provider
GET {{baseUrl}}/api/admin/providers/pending

### Approve (replace {id} with actual ID)
PUT {{baseUrl}}/api/admin/providers/15/approve
# Cookie sent automatically
Content-Type: application/json

{
  "adminNotes": "Approved for PayPal payment testing"
}

### Logout and login as PayPal provider
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "paypal.test@example.com",
  "password": "Provider@123"
}

### Subscribe using PAYPAL payment method
# @name subscribe-paypal
POST {{baseUrl}}/api/subscriptions/subscribe
# Cookie sent automatically
Content-Type: application/json

{
  "planId": 1,
  "paymentMethod": "paypal",
  "autoRenew": true,
  "paymentCard": {
    "cardNumber": "5555555555554444",
    "cardHolderName": "PayPal Test Provider",
    "expiryMonth": "06",
    "expiryYear": "2029",
    "cvv": "456",
    "billingAddress": "456 PayPal Avenue, NY"
  }
}

### Check transaction (should show PAYPAL_ prefix)
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

###
GET {{baseUrl}}/api/admin/transactions

### ---------- 5.3 Test Booking with STRIPE ----------
POST {{baseUrl}}/api/auth/logout

### Login as customer
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{customerEmail}}",
  "password": "{{customerPassword}}"
}

### Create booking with STRIPE payment
# @name booking-stripe
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 10,
  "slotId": 193,
  "paymentMethod": "stripe",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "cardHolderName": "Test Customer",
    "expiryMonth": "03",
    "expiryYear": "2027",
    "cvv": "789",
    "billingAddress": "789 Customer Lane, TX"
  }
}

### ---------- 5.4 Test Booking with PAYPAL ----------
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 10,
  "slotId": 190,
  "paymentMethod": "paypal",
  "paymentCard": {
    "cardNumber": "5555555555554444",
    "cardHolderName": "Test Customer PayPal",
    "expiryMonth": "09",
    "expiryYear": "2028",
    "cvv": "321",
    "billingAddress": "789 Customer Lane, TX"
  }
}

### Check transactions to see STRIPE_ and PAYPAL_ prefixes
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

###
GET {{baseUrl}}/api/admin/transactions

### ---------- 5.5 Test REFUND with Original Payment Method ----------
### Cancel a booking to trigger refund
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{customerEmail}}",
  "password": "{{customerPassword}}"
}

### Cancel booking (triggers auto-refund if <24hrs, or manual refund request)
PUT {{baseUrl}}/api/customer/bookings/7/cancel
# Cookie sent automatically
Content-Type: application/json

{
  "cancellationReason": "Testing refund with original payment gateway"
}

### Check if refund was auto-processed or needs admin approval
GET {{baseUrl}}/api/customer/bookings

### If manual approval needed, login as admin
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Get pending refunds
GET {{baseUrl}}/api/admin/refunds/pending

### Approve refund (replace {id} with actual refund ID)
PUT {{baseUrl}}/api/admin/refunds/3/approve
# Cookie sent automatically
Content-Type: application/json

{
  "adminNotes": "Refund approved - will be processed via original payment gateway"
}

### Check transactions - should see STRIPE_REFUND_ or PAYPAL_REFUND_
GET {{baseUrl}}/api/admin/transactions

### ---------- 5.6 Test PAYOUT to Provider ----------
### Login as provider to complete a booking
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{providerEmail}}",
  "password": "{{providerPassword}}"
}

### Get provider bookings
GET {{baseUrl}}/api/provider/bookings

### Complete a booking (triggers PAYOUT transaction)
PUT {{baseUrl}}/api/provider/bookings/5/complete
# Cookie sent automatically

### Check transactions as admin - should see STRIPE_PAYOUT_ or PAYPAL_PAYOUT_
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

###
GET {{baseUrl}}/api/admin/transactions

### ---------- 5.7 Test Invalid Payment Method (Expect Error) ----------
POST {{baseUrl}}/api/auth/logout

###
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{customerEmail}}",
  "password": "{{customerPassword}}"
}

### Try to book with unsupported payment method
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 1,
  "slotId": 20,
  "paymentMethod": "bitcoin",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "cardHolderName": "Test",
    "expiryMonth": "12",
    "expiryYear": "2027",
    "cvv": "123",
    "billingAddress": "Test Address"
  }
}
### Expected: 400 Bad Request - "Unsupported payment method: bitcoin. Supported methods: stripe, paypal, card"

### ---------- 5.8 Test 'card' Alias (Should Use Stripe) ----------
POST {{baseUrl}}/api/customer/bookings
# Cookie sent automatically
Content-Type: application/json

{
  "serviceId": 3,
  "slotId": 25,
  "paymentMethod": "card",
  "paymentCard": {
    "cardNumber": "4242424242424242",
    "cardHolderName": "Card Alias Test",
    "expiryMonth": "12",
    "expiryYear": "2027",
    "cvv": "123",
    "billingAddress": "Test Address"
  }
}
### ============================================================================
### END OF API TESTING FILE
### ============================================================================